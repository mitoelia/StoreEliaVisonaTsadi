<html xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:MSHelp="http://msdn.microsoft.com/mshelp" xmlns:mshelp="http://msdn.microsoft.com/mshelp" xmlns:ddue="http://ddue.schemas.microsoft.com/authoring/2003/5" xmlns:msxsl="urn:schemas-microsoft-com:xslt"><head><META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=UTF-8" /><META NAME="save" CONTENT="history" /><title>Utilizzo del buffer adattivo</title><meta name="Language" content="it-it" /><meta name="System.Keywords" content="adaptive" /><meta name="System.Keywords" content="buffer adattivo" /><meta name="System.Keywords" content="isWrapperFor" /><meta name="System.Keywords" content="selectMethod" /><meta name="System.Keywords" content="unwrap" /><meta name="Microsoft.Help.Id" content="92d4e3be-c3e9-4732-9a60-b57f4d0f7cb7" /><meta name="Description" content="La memorizzazione nel buffer adattiva è progettata per recuperare qualsiasi tipo di dati con valori di grandi dimensioni senza l'overhead dei cursori server." /><meta name="Microsoft.Help.ContentType" content="Concepts" /><link rel="stylesheet" type="text/css" href="../local/Classic.css" /><script type="text/javascript" src="../scripts/EventUtilities.js">&amp;nbsp;</script><script type="text/javascript" src="../scripts/SplitScreen.js">&amp;nbsp;</script><script type="text/javascript" src="../scripts/Dropdown.js">&amp;nbsp;</script><script type="text/javascript" src="../scripts/script_manifold.js">&amp;nbsp;</script><script type="text/javascript" src="../scripts/script_feedBack.js">&amp;nbsp;</script><script type="text/javascript" src="../scripts/CheckboxMenu.js">&amp;nbsp;</script><script type="text/javascript" src="../scripts/CommonUtilities.js">&amp;nbsp;</script><script type="text/javascript" src="../local/script_main.js">&amp;nbsp;</script></head><body><div id="header"><table id="bottomTable" cellpadding="0" cellspacing="0"><tr><td align="left"><span id="headerBold">Utilizzo del buffer adattivo</span></td></tr></table><table id="gradientTable"><tr><td class="nsrBottom" background="../icons/gradient.gif" /></tr></table></div><div id="mainSection"><div id="mainBody"><div class="introduction"><p>La memorizzazione nel buffer adattiva è progettata per recuperare qualsiasi tipo di dati con valori di grandi dimensioni senza l'overhead dei cursori server. Le applicazioni possono utilizzare la funzionalità di memorizzazione nel buffer adattiva con tutte le versioni di SQL Server supportate dal driver.</p><p>In genere, quando Microsoft JDBC Driver per SQL Server esegue una query, tutti i risultati vengono recuperati dal server e caricati nella memoria dell'applicazione. Sebbene questo approccio consenta di ridurre al minimo l'utilizzo delle risorse in SQL Server, è possibile che venga generato un errore di tipo <b>OutOfMemoryError</b> nell'applicazione JDBC per le query con risultati di dimensioni molto grandi.</p><p>Per consentire la gestione di risultati di dimensioni molto grandi da parte delle applicazioni, in Microsoft JDBC Driver per SQL Server è disponibile la memorizzazione nel buffer adattiva. Grazie alla memorizzazione nel buffer adattiva, il driver può recuperare i risultati dell'esecuzione di istruzioni da SQL Server quando questi sono necessari per l'applicazione e non tutti contemporaneamente. Quando l'applicazione non necessita più di accedere ai dati, questi vengono inoltre eliminati dal driver. Di seguito sono illustrati alcuni esempi di casi in cui il buffer adattivo può rivelarsi utile: </p><ul><li><p><b>La query produce un set di risultati di dimensioni molto grandi:</b> l'applicazione può eseguire un'istruzione SELECT che produce più righe di quante possano essere archiviate in memoria. Nelle versioni precedenti, l'applicazione utilizzava un cursore server per evitare un errore di tipo <b>OutOfMemoryError</b>. Il buffer adattivo consente di passare in modalità forward-only di sola lettura un set di risultati anche molto grande senza che sia necessario un cursore server. </p></li><li><p><b>La query produce colonne </b><a href="eaffcff1-286c-459f-83da-3150778480c9.htm">SQLServerResultSet</a><b> o valori del parametro OUT </b><a href="30710a63-c05d-47d9-9cf9-c087a1c76373.htm">SQLServerCallableStatement</a><b> di dimensioni molto grandi:</b> L'applicazione può recuperare un singolo valore (colonna o parametro OUT) di dimensioni troppo grandi per essere contenuto interamente nella memoria dell'applicazione. Il buffer adattivo consente all'applicazione client di recuperare tale valore come flusso, utilizzando il metodo <b>getAsciiStream</b>, <b>getBinaryStream,</b> o <b>getCharacterStream</b>. L'applicazione recupera il valore da SQL Server leggendolo dal flusso.</p><p /></li></ul><div style="margin: .5em 1.5em .5em 1.5em"><b></b><p>Con il buffer adattivo il driver JDBC memorizza nel buffer solo la quantità di dati necessaria e non fornisce alcun metodo pubblico per controllare o limitare le dimensioni del buffer.</p></div></div><h1 class="heading">Impostazione del buffer adattivo</h1><div id="sectionSection0" class="section" name="collapseableSection" style=""><p>A partire da Microsoft JDBC Driver versione 2.0 il comportamento predefinito è "<span sdata="langKeyword" value="adaptive"><span class="keyword">adaptive</span></span>". In altre parole, per ottenere il comportamento del buffer adattivo in questa versione, l'applicazione non deve richiederlo in modo esplicito. Nella versione 1.2, tuttavia, la modalità di buffer predefinita è "<span sdata="langKeyword" value="full"><span class="keyword">full</span></span>" e l'applicazione deve richiedere la modalità di buffer adattivo in modo esplicito.</p><p>Un'applicazione può richiedere l'utilizzo del buffer adattivo nell'esecuzione di un'istruzione in tre modi:</p><ul><li><p>L'applicazione può impostare la proprietà di connessione <span sdata="langKeyword" value="responseBuffering"><span class="keyword">responseBuffering</span></span> su "adaptive". Per ulteriori informazioni sull'impostazione delle proprietà di connessione, vedere <span sdata="link"><a href="f1b62700-f046-488d-bd6b-a5cd8fc345b7.htm">Impostazione delle proprietà delle connessioni</a></span>. </p></li><li><p>L'applicazione può utilizzare il metodo <a href="c9e43ff2-8117-4dca-982d-83c863d0c8e1.htm">setResponseBuffering</a> dell'oggetto <a href="097434fd-2b74-411c-a5ed-eba04481dde5.htm">SQLServerDataSource</a> per impostare la modalità di memorizzazione delle risposte nel buffer per tutte le connessioni create tramite tale oggetto <a href="097434fd-2b74-411c-a5ed-eba04481dde5.htm">SQLServerDataSource</a>.</p></li><li><p>L'applicazione può utilizzare il metodo <a href="9f489835-6cda-4c8c-b139-079639a169cf.htm">setResponseBuffering</a> della classe <a href="ec24963c-8b51-4838-91e9-1fbfa2347451.htm">SQLServerStatement</a> per impostare la modalità di memorizzazione delle risposte nel buffer per un oggetto istruzione specifico. </p></li></ul><p>Quando si utilizza Microsoft JDBC Driver versione 1.2, le applicazioni devono eseguire il cast dell'oggetto istruzione in una classe <a href="ec24963c-8b51-4838-91e9-1fbfa2347451.htm">SQLServerStatement</a> per utilizzare il metodo <a href="9f489835-6cda-4c8c-b139-079639a169cf.htm">setResponseBuffering</a>. Questo tipo di utilizzo è illustrato negli esempi di codice descritti in <span sdata="link"><a href="6c986144-3854-4352-8331-e79eccbefc28.htm">Esempio di lettura di dati di grandi dimensioni</a></span> e <span sdata="link"><a href="58c76635-a117-4661-8781-d6cb231c5809.htm">Esempio di lettura di dati di grandi dimensioni con una stored procedure</a></span>. </p><p>Con Microsoft JDBC Driver versione 2.0, tuttavia, le applicazioni possono utilizzare i metodi <a href="53f3291f-d43a-476b-a656-d86168dacf6c.htm">isWrapperFor</a> e <a href="ce680176-ef04-4e44-bb6c-ec50bd06e7e6.htm">unwrap</a> per accedere a funzionalità specifiche del fornitore senza presupporre l'implementazione della gerarchia di classi. Per un esempio di codice vedere <span sdata="link"><a href="76ecc05f-a77d-40a2-bab9-91a7fcf17347.htm">Esempio di aggiornamento di dati di grandi dimensioni</a></span>.</p></div><h1 class="heading">Recupero di dati di grandi dimensioni con il buffer adattivo</h1><div id="sectionSection1" class="section" name="collapseableSection" style=""><p>Quando i valori di grandi dimensioni vengono letti una volta utilizzando i metodi get&lt;Type&gt;Stream e viene eseguito l'accesso alle colonne ResultSet e ai parametri OUT CallableStatement nell'ordine restituito da SQL Server, il buffer adattivo consente di ridurre al minimo l'utilizzo della memoria dell'applicazione durante l'elaborazione dei risultati. Quando si utilizza il buffer adattivo, si verifica quanto indicato di seguito:</p><ul><li><p>I metodi <b>get&lt;Type&gt;Stream</b> definiti nelle classi <a href="eaffcff1-286c-459f-83da-3150778480c9.htm">SQLServerResultSet</a> e <a href="30710a63-c05d-47d9-9cf9-c087a1c76373.htm">SQLServerCallableStatement</a> restituiscono per impostazione predefinita flussi che possono essere letti una sola volta, sebbene possano essere reimpostati, se contrassegnati dall'applicazione. Per applicare il metodo <span class="code">reset</span> al flusso, l'applicazione deve prima chiamare il metodo <span class="code">mark</span> su tale flusso. </p></li><li><p>I metodi <b>get&lt;Type&gt;Stream</b> definiti nelle classi <a href="24170524-e1ab-4e80-8fd1-6688efacfbde.htm">SQLServerClob</a> e <a href="88bd8623-889d-4b5d-99ff-c85b32f3ff5c.htm">SQLServerBlob</a> restituiscono flussi che possono essere sempre spostati nella posizione iniziale del flusso senza chiamare il metodo <span class="code">mark</span>. </p></li></ul><p>Quando l'applicazione utilizza il buffer adattivo, i valori recuperati dai metodi <b>get&lt;Type&gt;Stream</b> possono essere recuperati una sola volta. Se si tenta di chiamare qualsiasi metodo <b>get&lt;Type&gt;</b> sulla stessa colonna o sullo stesso parametro dopo avere chiamato il metodo <b>get&lt;Type&gt;Stream</b> dello stesso oggetto, verrà generata un'eccezione con il messaggio "Accesso ai dati eseguito. Dati non disponibili per questa colonna o questo parametro".</p></div><h1 class="heading">Linee guida per l'utilizzo del buffer adattivo</h1><div id="sectionSection2" class="section" name="collapseableSection" style=""><p>Per ridurre al minimo l'utilizzo della memoria da parte dell'applicazione, gli sviluppatori devono attenersi alle importanti linee guida seguenti:</p><ul><li><p>Evitare di utilizzare la proprietà della stringa di connessione <span sdata="langKeyword" value="selectMethod=cursor"><span class="keyword">selectMethod=cursor</span></span> per consentire all'applicazione di elaborare un set di risultati di dimensioni molto grandi. La caratteristica di buffer adattivo consente alle applicazioni di elaborare set di risultati forward-only di sola lettura di dimensioni molto grandi senza utilizzare un cursore server. Si noti che l'impostazione di <span sdata="langKeyword" value="selectMethod=cursor"><span class="keyword">selectMethod=cursor</span></span> influisce su tutti i set di risultati forward-only di sola lettura prodotti da tale connessione. In altre parole, se l'applicazione elabora regolarmente set di risultati brevi contenenti alcune righe, per la creazione, la lettura e la chiusura di un cursore server per ogni set di risultati sia sul lato server che sul lato client verrà utilizzato un maggior numero di risorse rispetto a quando <span sdata="langKeyword" value="selectMethod"><span class="keyword">selectMethod</span></span> non è impostato su <span sdata="langKeyword" value="cursor"><span class="keyword">cursor</span></span>.</p></li><li><p>Leggere i valori binari o di testo di grandi dimensioni come flussi utilizzando il metodo <b>getAsciiStream</b>, <b>getBinaryStream,</b> o <b>getCharacterStream</b> anziché il metodo <b>getBlob</b> o <b>getClob</b>. A partire dalla versione 1.2 la classe <a href="30710a63-c05d-47d9-9cf9-c087a1c76373.htm">SQLServerCallableStatement</a> fornisce nuovi metodi <b>get&lt;Type&gt;Stream</b> da utilizzare a questo scopo.</p></li><li><p>Assicurarsi che le colonne con valori potenzialmente grandi siano posizionate per ultime nell'elenco di colonne in un'istruzione SELECT e che i metodi <b>get&lt;Type&gt;Stream</b> di <a href="eaffcff1-286c-459f-83da-3150778480c9.htm">SQLServerResultSet</a> vengano utilizzati per accedere alle colonne nell'ordine in cui vengono selezionate.</p></li><li><p>Assicurarsi che i parametri OUT con valori potenzialmente grandi siano dichiarati per ultimi nell'elenco di parametri nel linguaggio SQL utilizzato per creare <a href="30710a63-c05d-47d9-9cf9-c087a1c76373.htm">SQLServerCallableStatement</a>. Assicurarsi inoltre che i metodi <b>get&lt;Type&gt;Stream</b> di <a href="30710a63-c05d-47d9-9cf9-c087a1c76373.htm">SQLServerCallableStatement</a> vengano utilizzati per accedere ai parametri OUT nell'ordine in cui vengono dichiarati.</p></li><li><p>Evitare di eseguire simultaneamente più di un'istruzione nella stessa connessione. Se viene eseguita un'altra istruzione prima dell'elaborazione dei risultati dell'istruzione precedente, i risultati non elaborati potrebbero venire memorizzati nel buffer della memoria dell'applicazione.</p></li><li><p>Di seguito sono descritti alcuni casi in cui è più conveniente utilizzare <span sdata="langKeyword" value="selectMethod=cursor"><span class="keyword">selectMethod=cursor</span></span> anziché <span sdata="langKeyword" value="responseBuffering=adaptive"><span class="keyword">responseBuffering=adaptive</span></span>.</p><ul><li><p>Se l'applicazione elabora lentamente un set di risultati forward-only di sola lettura, ad esempio quando le singole righe vengono lette dopo un certo input utente, l'utilizzo di  <span sdata="langKeyword" value="selectMethod=cursor"><span class="keyword">selectMethod=cursor</span></span> anziché <span sdata="langKeyword" value="responseBuffering=adaptive"><span class="keyword">responseBuffering=adaptive</span></span> può contribuire a ridurre l'utilizzo delle risorse da parte di SQL Server. </p></li><li><p>Se l'applicazione elabora due o più set di risultati forward-only di sola lettura contemporaneamente nella stessa connessione, l'utilizzo di <span sdata="langKeyword" value="selectMethod=cursor"><span class="keyword">selectMethod=cursor</span></span> anziché  <span sdata="langKeyword" value="responseBuffering=adaptive"><span class="keyword">responseBuffering=adaptive</span></span> può contribuire a ridurre la memoria richiesta dal driver durante l'elaborazione dei set di risultati.</p></li></ul><p>In entrambi i casi, è opportuno considerare l'overhead generato dalla creazione, dalla lettura e dalla chiusura dei cursori server.</p></li></ul><p>Nel seguente elenco vengono inoltre fornite alcune indicazioni relative ai set di risultati scorrevoli e forward-only aggiornabili.</p><ul><li><p>Per i set di risultati scorrevoli, durante il recupero di un blocco di righe il driver legge sempre in memoria il numero di righe indicate dal metodo <a href="7bc96930-b0c9-42f6-8df9-1d8d824408b3.htm">getFetchSize</a> dell'oggetto <a href="eaffcff1-286c-459f-83da-3150778480c9.htm">SQLServerResultSet</a> , anche quando il buffer adattivo è abilitato. Se lo scorrimento causa un errore di tipo <b>OutOfMemoryError</b>, è possibile ridurre il numero di righe recuperate chiamando il metodo <a href="233bf4f8-4758-42d0-a80b-33e34fa78027.htm">setFetchSize</a> dell'oggetto <a href="eaffcff1-286c-459f-83da-3150778480c9.htm">SQLServerResultSet</a> per impostare la dimensione di recupero su un numero minore di righe, persino fino a una se necessario. Se in tal modo non si previene l'errore di tipo <b>OutOfMemoryError, </b>evitare di includere colonne particolarmente estese nei set di risultati scorrevoli.</p></li><li><p>Per i set di risultati forward-only aggiornabili, durante il recupero di un blocco di righe il driver legge in genere in memoria il numero di righe indicate dal metodo <a href="7bc96930-b0c9-42f6-8df9-1d8d824408b3.htm">getFetchSize</a> dell'oggetto <a href="eaffcff1-286c-459f-83da-3150778480c9.htm">SQLServerResultSet</a> , anche quando il buffer adattivo è abilitato per la connessione. Se chiamando il metodo <a href="60248447-6908-4036-a779-a501453cd553.htm">next</a> dell'oggetto <a href="eaffcff1-286c-459f-83da-3150778480c9.htm">SQLServerResultSet</a> viene restituito un errore di tipo <b>OutOfMemoryError</b>, è possibile ridurre il numero di righe recuperate chiamando il metodo <a href="233bf4f8-4758-42d0-a80b-33e34fa78027.htm">setFetchSize</a> dell'oggetto <a href="eaffcff1-286c-459f-83da-3150778480c9.htm">SQLServerResultSet</a> per impostare la dimensione di recupero su un numero minore di righe, persino fino a una se necessario. È inoltre possibile forzare il driver a non memorizzare nel buffer alcuna riga chiamando il metodo <a href="9f489835-6cda-4c8c-b139-079639a169cf.htm">setResponseBuffering</a> dell'oggetto <a href="ec24963c-8b51-4838-91e9-1fbfa2347451.htm">SQLServerStatement</a> con il parametro "<span sdata="langKeyword" value="adaptive"><span class="keyword">adaptive</span></span>" prima di eseguire l'istruzione. Poiché il set di risultati non è scorrevole, se l'applicazione accede a un valore di colonna di grandi dimensioni utilizzando uno dei metodi <b>get&lt;Type&gt;Stream</b>, il driver eliminerà il valore non appena verrà letto dall'applicazione come avviene per i set di risultati forward-only di sola lettura.</p></li></ul></div><span id="seeAlsoSpan"><h1 class="heading">Vedere anche</h1></span><div id="seeAlsoSection" class="section" name="collapseableSection" style=""><div class="seeAlsoStyle"><span sdata="link"><a href="e1592499-b87b-45ee-bab8-beaba8fde841.htm">Utilizzo del driver JDBC per il miglioramento di prestazioni e affidabilità</a></span></div></div></div><div id="footer" class="section"><span id="feedbackarea">Inviare <a href="javascript:SubmitFeedback('DevDocs@Microsoft.com','','','','8.0.12060.10000','%0\dThank%20you%20for%20your%20feedback.%20The%20developer%20writing%20teams%20use%20your%20feedback%20to%20improve%20documentation.%20While%20we%20are%20reviewing%20your%20feedback,%20we%20may%20send%20you%20e-mail%20to%20ask%20for%20clarification%20or%20feedback%20on%20a%20solution.%20We%20do%20not%20use%20your%20e-mail%20address%20for%20any%20other%20purpose%20and%20we%20delete%20it%20after%20we%20finish%20our%20review.%0\AFor%20further%20information%20about%20the%20privacy%20policies%20of%20Microsoft,%20please%20see%20http://privacy.microsoft.com/it-it/default.aspx.%0\A%0\d','Customer%20Feedback');">commenti e suggerimenti</a> su questo argomento a Microsoft.</span><span id="copyrightarea"><p><a href="9bad553b-9e70-4696-8499-2e35f772a1e0.htm">© 2012 Microsoft. Tutti i diritti sono riservati.</a></p></span></div></div></body></html>