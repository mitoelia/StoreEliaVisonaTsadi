<html xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:MSHelp="http://msdn.microsoft.com/mshelp" xmlns:mshelp="http://msdn.microsoft.com/mshelp" xmlns:ddue="http://ddue.schemas.microsoft.com/authoring/2003/5" xmlns:msxsl="urn:schemas-microsoft-com:xslt"><head><META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=UTF-8" /><META NAME="save" CONTENT="history" /><title>Utilizzo dell'autenticazione integrata Kerberos per la connessione a SQL Server</title><meta name="Language" content="it-it" /><meta name="Microsoft.Help.Id" content="687802dc-042a-4363-89aa-741685d165b3" /><meta name="Description" content="A partire da Microsoft JDBC Driver 4.0 per SQL Server, per un'applicazione è possibile utilizzare la proprietà di connessione authenticationScheme per specificare una connessione a un database tramite l'autenticazione integrata Kerberos di tipo 4." /><meta name="Microsoft.Help.ContentType" content="Concepts" /><link rel="stylesheet" type="text/css" href="../local/Classic.css" /><script type="text/javascript" src="../scripts/EventUtilities.js">&amp;nbsp;</script><script type="text/javascript" src="../scripts/SplitScreen.js">&amp;nbsp;</script><script type="text/javascript" src="../scripts/Dropdown.js">&amp;nbsp;</script><script type="text/javascript" src="../scripts/script_manifold.js">&amp;nbsp;</script><script type="text/javascript" src="../scripts/script_feedBack.js">&amp;nbsp;</script><script type="text/javascript" src="../scripts/CheckboxMenu.js">&amp;nbsp;</script><script type="text/javascript" src="../scripts/CommonUtilities.js">&amp;nbsp;</script><script type="text/javascript" src="../local/script_main.js">&amp;nbsp;</script></head><body><div id="header"><table id="bottomTable" cellpadding="0" cellspacing="0"><tr><td align="left"><span id="headerBold">Utilizzo dell'autenticazione integrata Kerberos per la connessione a SQL Server</span></td></tr></table><table id="gradientTable"><tr><td class="nsrBottom" background="../icons/gradient.gif" /></tr></table></div><div id="mainSection"><div id="mainBody"><div class="introduction"><p>A partire da Microsoft JDBC Driver 4.0 per SQL Server, per un'applicazione è possibile utilizzare la proprietà di connessione <span sdata="langKeyword" value="authenticationScheme"><span class="keyword">authenticationScheme</span></span> per specificare una connessione a un database tramite l'autenticazione integrata Kerberos di tipo 4. Per ulteriori informazioni sulle proprietà di connessione, vedere <span sdata="link"><a href="f1b62700-f046-488d-bd6b-a5cd8fc345b7.htm">Impostazione delle proprietà delle connessioni</a></span>. Per ulteriori informazioni su Kerberos, vedere <a href="http://go.microsoft.com/fwlink/?LinkId=101449">Supplemento tecnico su Kerberos per Windows</a> e <a href="http://go.microsoft.com/fwlink/?LinkID=100758">Microsoft Kerberos</a>.</p><p>Quando si utilizza l'autenticazione integrata con il modulo Java <span sdata="langKeyword" value="Krb5LoginModule"><span class="keyword">Krb5LoginModule</span></span>, è possibile configurare il modulo utilizzando la <a href="http://download.oracle.com/javase/1.5.0/docs/guide/security/jaas/spec/com/sun/security/auth/module/Krb5LoginModule.html">classe Krb5LoginModule</a>.</p><p>Tramite Microsoft JDBC Driver per SQL Server vengono impostate le proprietà seguenti per ambienti Java Virtual Machine IBM:</p><ul><li><p><span sdata="langKeyword" value="useDefaultCcache = true"><span class="keyword">useDefaultCcache = true</span></span></p></li><li><p><span sdata="langKeyword" value="moduleBanner = false"><span class="keyword">moduleBanner = false</span></span></p></li></ul><p>Tramite Microsoft JDBC Driver per SQL Server vengono impostate le proprietà seguenti per tutti gli altri ambienti Java Virtual Machine:</p><ul><li><p><span sdata="langKeyword" value="useTicketCache = true"><span class="keyword">useTicketCache = true</span></span></p></li><li><p><span sdata="langKeyword" value="doNotPrompt = true"><span class="keyword">doNotPrompt = true</span></span></p></li></ul></div><h1 class="heading">Osservazioni</h1><div id="sectionSection0" class="section" name="collapseableSection" style=""><p>Nelle versioni precedenti a Microsoft JDBC Driver 4.0 per SQL Server, per le applicazioni è possibile specificare l'autenticazione integrata (tramite Kerberos o NTLM, a seconda dell'autenticazione disponibile) utilizzando la proprietà di connessione <span sdata="langKeyword" value="integratedSecurity"><span class="keyword">integratedSecurity</span></span> e facendo riferimento a <span sdata="langKeyword" value="sqljdbc_auth.dll"><span class="keyword">sqljdbc_auth.dll</span></span>, come descritto in <span sdata="link"><a href="44996746-d373-4f59-9863-a8a20bb8024a.htm">Costruzione dell'URL della connessione</a></span>.</p><p>A partire da Microsoft JDBC Driver 4.0 per SQL Server, per un'applicazione è possibile utilizzare la proprietà di connessione <span sdata="langKeyword" value="authenticationScheme"><span class="keyword">authenticationScheme</span></span> per specificare una connessione a un database tramite l'autenticazione integrata Kerberos e l'implementazione Kerberos Java pura.</p><ul><li><p>Se si desidera utilizzare l'autenticazione integrata tramite <span sdata="langKeyword" value="Krb5LoginModule"><span class="keyword">Krb5LoginModule</span></span>, è comunque necessario specificare la proprietà di connessione <span sdata="langKeyword" value="integratedSecurity=true"><span class="keyword">integratedSecurity=true</span></span>. In questo caso, è quindi necessario specificare anche la proprietà di connessione <span sdata="langKeyword" value="authenticationScheme=JavaKerberos"><span class="keyword">authenticationScheme=JavaKerberos</span></span>.</p></li><li><p>Per continuare a utilizzare l'autenticazione integrata con <span sdata="langKeyword" value="sqljdbc_auth.dll"><span class="keyword">sqljdbc_auth.dll</span></span>, specificare solo la proprietà di connessione <span sdata="langKeyword" value="integratedSecurity=true"><span class="keyword">integratedSecurity=true</span></span> (ed eventualmente <span sdata="langKeyword" value="authenticationScheme=NativeAuthentication"><span class="keyword">authenticationScheme=NativeAuthentication</span></span>).</p></li><li><p>Se si specifica <span sdata="langKeyword" value="authenticationScheme=JavaKerberos"><span class="keyword">authenticationScheme=JavaKerberos</span></span>, ma senza specificare anche <span sdata="langKeyword" value="integratedSecurity=true"><span class="keyword">integratedSecurity=true</span></span>, la proprietà di connessione <span sdata="langKeyword" value="authenticationScheme"><span class="keyword">authenticationScheme</span></span> verrà ignorata dal driver e le credenziali di nome utente e password verranno trovate nella stringa di connessione.</p></li></ul><p>Quando si utilizza un'origine dati per creare connessioni, è possibile impostare a livello di codice lo schema di autenticazione utilizzando <a href="b942f78e-7ce1-44ef-923d-a7c3d7c76b83.htm">setAuthenticationScheme</a>.</p><p>È stato aggiunto un nuovo logger per supportare l'autenticazione Kerberos: com.microsoft.sqlserver.jdbc.internals.KerbAuthentication. Per ulteriori informazioni, vedere <span sdata="link"><a href="723aeae7-6504-4585-ba8b-3525115bea8b.htm">Creazione di tracce</a></span>.</p><p>Le linee guida seguenti consentono di configurare Kerberos:</p><ol><li><p>Impostare <span sdata="langKeyword" value="AllowTgtSessionKey"><span class="keyword">AllowTgtSessionKey</span></span> su 1 nel Registro di sistema per Windows. Per ulteriori informazioni, vedere <a href="http://support.microsoft.com/kb/837361">Voci del Registro di sistema del protocollo Kerberos e chiavi di configurazione KDC in Windows Server 2003</a>.</p></li><li><p>Assicurarsi che la configurazione di Kerberos (krb5.conf in ambienti UNIX) punti all'area di autenticazione e al servizio KDC corretti per l'ambiente.</p></li><li><p>Inizializzare la cache TGT tramite kinit o accedendo al dominio.</p></li><li><p>Quando un'applicazione in cui <span sdata="langKeyword" value="authenticationScheme=JavaKerberos"><span class="keyword">authenticationScheme=JavaKerberos</span></span> viene eseguita nel sistema operativo Windows Vista o Windows 7, è consigliabile utilizzare un account utente standard. Se, tuttavia, si utilizza un account amministratore, l'applicazione deve essere eseguita con privilegi di amministratore.</p></li></ol></div><h1 class="heading">Nomi dell'entità servizio</h1><div id="sectionSection1" class="section" name="collapseableSection" style=""><p>Un nome dell'entità servizio (SPN, Server Principal Name) è un nome tramite il quale un client identifica in modo univoco un'istanza di un servizio. Per ulteriori informazioni sui nomi dell'entità servizio (SPN), vedere:</p><ul><li><p><a href="http://support.microsoft.com/kb/319723">Come utilizzare l'autenticazione Kerberos in SQL Server</a></p></li><li><p><a href="http://go.microsoft.com/fwlink/?LinkId=207814">Utilizzo di Kerberos con SQL Server</a></p></li></ul></div><h1 class="heading">Creazione di un file di configurazione del modulo di accesso</h1><div id="sectionSection2" class="section" name="collapseableSection" style=""><p>È eventualmente possibile specificare un file di configurazione Kerberos. Se non si specifica un file di configurazione, vengono utilizzate le impostazioni seguenti:</p><dl class="authored"><dt>JVM Sun</dt><dd><p>com.sun.security.auth.module.Krb5LoginModule required useTicketCache=true doNotPrompt=true;</p></dd><dt>JVM IBM</dt><dd><p>com.ibm.security.auth.module.Krb5LoginModule required useDefaultCcache = true moduleBanner = false;</p></dd></dl><p>Se si sceglie di creare un file di configurazione del modulo di accesso, per il file è necessario utilizzare il formato seguente:</p><div class="sampleCode"><span codeLanguage="other"><pre>&lt;<i>name</i>&gt; {
    &lt;<i>LoginModule</i>&gt; &lt;<i>flag</i>&gt; &lt;<i>LoginModule options</i>&gt;;
    &lt;<i>optional_additional_LoginModules</i>, <i>flags_and_options</i>&gt;;
};</pre></span></div><p>Un file di configurazione di accesso è costituito da una o più voci, ciascuna indicante la tecnologia di autenticazione sottostante da utilizzare per un'applicazione o più applicazioni specifiche. Ad esempio:</p><div class="sampleCode"><span codeLanguage="other"><pre>SQLJDBCDriver {
   com.sun.security.auth.module.Krb5LoginModule required useTicketCache=true doNotPrompt=true;
};</pre></span></div><p>Di conseguenza, ogni voce del file di configurazione del modulo di accesso è costituita da un nome seguito da una o più voci specifiche di LoginModule, in cui ogni voce termina con un punto e virgola e l'intero gruppo di voci è racchiuso tra parentesi graffe. Ogni voce del file di configurazione termina con un punto e virgola.</p><p>Oltre a consentire al driver di acquisire credenziali Kerberos tramite le impostazioni specificate nel file di configurazione del modulo di accesso, il driver può utilizzare credenziali esistenti. Questo comportamento può risultare utile quando è necessario che tramite l'applicazione vengano create connessioni con credenziali di più di un utente.</p><p>Tramite il driver verrà effettuato il tentativo di utilizzare credenziali esistenti, se disponibili, prima di accedere utilizzando il modulo di accesso specificato. Di conseguenza, quando si utilizza il metodo Subject.doAs per l'esecuzione di codice in un contesto specifico, viene creata una connessione con le credenziali passate alla chiamata di Subject.doAs.</p><p>Per ulteriori informazioni, vedere le pagine Web relative al <a href="http://download.oracle.com/javase/1.4.2/docs/guide/security/jaas/tutorials/LoginConfigFile.html">file di configurazione di accesso JAAS</a> e alla <a href="http://download.oracle.com/javase/1.5.0/docs/guide/security/jgss/tutorials/KerberosReq.html">classe Krb5LoginModule</a>.</p></div><h1 class="heading">Creazione di un file di configurazione Kerberos</h1><div id="sectionSection3" class="section" name="collapseableSection" style=""><p>Per ulteriori informazioni sui file di configurazione Kerberos, vedere la pagina Web relativa ai <a href="http://download.oracle.com/javase/1.4.2/docs/guide/security/jaas/tutorials/LoginConfigFile.html">requisiti per Kerberos</a>.</p><p>Di seguito viene presentato un esempio di file di configurazione di un dominio, in cui YYYY e ZZZZ sono nomi di dominio nel sito.</p><div class="sampleCode"><span codeLanguage="other"><pre>[libdefaults]
default_realm = YYYY.CORP.CONTOSO.COM
dns_lookup_realm = false
dns_lookup_kdc = true
ticket_lifetime = 24h
forwardable = yes

[domain_realm]
.yyyy.corp.contoso.com = YYYY.CORP.CONTOSO.COM
.zzzz.corp.contoso.com = ZZZZ.CORP.CONTOSO.COM

[realms]
        YYYY.CORP.CONTOSO.COM = {
  kdc = krbtgt/YYYY.CORP. CONTOSO.COM @ YYYY.CORP. CONTOSO.COM
  default_domain = YYYY.CORP. CONTOSO.COM
}

        ZZZZ.CORP. CONTOSO.COM = {
  kdc = krbtgt/ZZZZ.CORP. CONTOSO.COM @ ZZZZ.CORP. CONTOSO.COM
  default_domain = ZZZZ.CORP. CONTOSO.COM
}
</pre></span></div></div><h1 class="heading">Abilitazione del file di configurazione del dominio e del file di configurazione del modulo di accesso</h1><div id="sectionSection4" class="section" name="collapseableSection" style=""><p>È possibile abilitare un file di configurazione del dominio con -Djava.security.krb5.conf. È possibile abilitare un file di configurazione del modulo di accesso con <span sdata="langKeyword" value="-Djava.security.auth.login.config"><span class="keyword">-Djava.security.auth.login.config</span></span>.</p><p>Quando, ad esempio, si avvia l'applicazione, è possibile utilizzare la riga di comando seguente:</p><div class="sampleCode"><span codeLanguage="other"><pre>Java.exe -Djava.security.auth.login.config=SQLJDBCDriver.conf -Djava.security.krb5.conf=krb5.ini &lt;<i>APPLICATION_NAME</i>&gt;
</pre></span></div></div><h1 class="heading">Verifica dell'accesso a SQL Server tramite Kerberos</h1><div id="sectionSection5" class="section" name="collapseableSection" style=""><p>Eseguire la query seguente in SQL Server Management Studio:</p><p><span sdata="langKeyword" value="select auth_scheme from sys.dm_exec_connections where session_id=@@spid"><span class="keyword">select auth_scheme from sys.dm_exec_connections where session_id=@@spid</span></span></p><p>Assicurarsi di disporre dell'autorizzazione necessaria per l'esecuzione della query.</p></div><span id="seeAlsoSpan"><h1 class="heading">Vedere anche</h1></span><div id="seeAlsoSection" class="section" name="collapseableSection" style=""><div class="seeAlsoStyle"><span sdata="link"><a href="94bcfbe3-f00e-4774-bda8-bb7577518fec.htm">Connessione a SQL Server con il driver JDBC</a></span></div></div></div><div id="footer" class="section"><span id="feedbackarea">Inviare <a href="javascript:SubmitFeedback('DevDocs@Microsoft.com','','','','8.0.12060.10000','%0\dThank%20you%20for%20your%20feedback.%20The%20developer%20writing%20teams%20use%20your%20feedback%20to%20improve%20documentation.%20While%20we%20are%20reviewing%20your%20feedback,%20we%20may%20send%20you%20e-mail%20to%20ask%20for%20clarification%20or%20feedback%20on%20a%20solution.%20We%20do%20not%20use%20your%20e-mail%20address%20for%20any%20other%20purpose%20and%20we%20delete%20it%20after%20we%20finish%20our%20review.%0\AFor%20further%20information%20about%20the%20privacy%20policies%20of%20Microsoft,%20please%20see%20http://privacy.microsoft.com/it-it/default.aspx.%0\A%0\d','Customer%20Feedback');">commenti e suggerimenti</a> su questo argomento a Microsoft.</span><span id="copyrightarea"><p><a href="9bad553b-9e70-4696-8499-2e35f772a1e0.htm">© 2012 Microsoft. Tutti i diritti sono riservati.</a></p></span></div></div></body></html>